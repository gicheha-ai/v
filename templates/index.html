<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚è∞ Hourly EUR/GBP Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <style>
        :root {
            --buy-color: #28a745;
            --sell-color: #dc3545;
            --neutral-color: #6c757d;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .price-display {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(45deg, #00b4db, #0083b0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .signal-badge {
            font-size: 1.2rem;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
        }
        
        .signal-buy {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            animation: pulse-green 2s infinite;
        }
        
        .signal-sell {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
            animation: pulse-red 2s infinite;
        }
        
        .signal-neutral {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
        }
        
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }
        
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
        
        .trade-level {
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .entry-zone {
            background: rgba(0, 180, 219, 0.2);
            border-left: 5px solid #00b4db;
        }
        
        .tp-zone {
            background: rgba(40, 167, 69, 0.2);
            border-left: 5px solid #28a745;
        }
        
        .sl-zone {
            background: rgba(220, 53, 69, 0.2);
            border-left: 5px solid #dc3545;
        }
        
        .confidence-meter {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .confidence-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease;
        }
        
        .timeframe-badge {
            font-size: 0.8rem;
            padding: 5px 10px;
            border-radius: 15px;
            margin: 2px;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <!-- Header -->
        <div class="glass-card p-4 mb-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-5 fw-bold">
                        ‚è∞ Hourly EUR/GBP Predictor
                    </h1>
                    <p class="lead mb-0">
                        AI-powered hourly predictions with entry zones and stop levels
                    </p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="badge bg-info fs-6">
                        Next Update: <span id="nextUpdate">00:00</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Current Market & Prediction -->
            <div class="col-lg-4">
                <!-- Current Price -->
                <div class="glass-card p-4 mb-4">
                    <h4 class="mb-3">üìà Current Market</h4>
                    <div class="text-center">
                        <div class="price-display mb-2" id="currentPrice">0.86000</div>
                        <p class="text-muted">EUR/GBP Live Price</p>
                        
                        <div class="row mt-3">
                            <div class="col-6">
                                <div class="glass-card p-2 text-center">
                                    <small class="text-muted">Hour Trend</small>
                                    <div class="fw-bold" id="hourTrend">UP ‚ÜóÔ∏è</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="glass-card p-2 text-center">
                                    <small class="text-muted">Volatility</small>
                                    <div class="fw-bold" id="volatility">Low</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Prediction Signal -->
                <div class="glass-card p-4 mb-4">
                    <h4 class="mb-3">ü§ñ AI Prediction</h4>
                    <div class="text-center">
                        <div class="signal-badge signal-neutral mb-3" id="predictionSignal">
                            NEUTRAL
                        </div>
                        
                        <div class="confidence-meter mb-2">
                            <div id="confidenceFill" class="confidence-fill bg-success" style="width: 75%"></div>
                        </div>
                        <p class="text-muted small">
                            Confidence: <span id="confidenceValue">75%</span>
                        </p>
                        
                        <div class="row mt-3">
                            <div class="col-6">
                                <div class="glass-card p-2">
                                    <small>Success Probability</small>
                                    <div class="fw-bold text-success" id="successProb">85%</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="glass-card p-2">
                                    <small>Risk Level</small>
                                    <div class="fw-bold text-danger" id="riskLevel">15%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hour End Prediction -->
                <div class="glass-card p-4">
                    <h4 class="mb-3">üéØ Hour End Prediction</h4>
                    <div class="text-center">
                        <div class="display-6 fw-bold mb-2" id="hourEndPrice">0.86200</div>
                        <p class="text-muted">
                            Expected in: <span id="timeRemaining">45:00</span>
                        </p>
                        <div class="progress" style="height: 10px;">
                            <div id="hourProgress" class="progress-bar bg-info" style="width: 25%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Chart -->
            <div class="col-lg-5">
                <div class="glass-card p-4 mb-4" style="height: 400px;">
                    <h4 class="mb-3">üìä Trading Chart with Zones</h4>
                    <canvas id="tradingChart" height="300"></canvas>
                </div>

                <!-- Trade Levels -->
                <div class="glass-card p-4">
                    <h4 class="mb-3">üéØ Trade Levels</h4>
                    
                    <!-- Entry Zone -->
                    <div class="trade-level entry-zone">
                        <div class="row">
                            <div class="col-8">
                                <h5>üéØ ENTRY ZONE</h5>
                                <p class="mb-1"><small>Buy/Sell in this zone</small></p>
                                <p class="mb-0"><span id="entryZoneRange">0.85980 - 0.86020</span></p>
                            </div>
                            <div class="col-4 text-end">
                                <div class="badge bg-primary fs-5" id="entryAction">BUY</div>
                            </div>
                        </div>
                    </div>

                    <!-- Take Profit -->
                    <div class="trade-level tp-zone">
                        <div class="row">
                            <div class="col-8">
                                <h5>‚úÖ TAKE PROFIT</h5>
                                <p class="mb-1"><small>Target profit level</small></p>
                                <p class="mb-0"><span id="tpLevel">0.86300</span></p>
                            </div>
                            <div class="col-4 text-end">
                                <div class="badge bg-success fs-5" id="tpPips">+32.0 pips</div>
                            </div>
                        </div>
                    </div>

                    <!-- Stop Loss -->
                    <div class="trade-level sl-zone">
                        <div class="row">
                            <div class="col-8">
                                <h5>üõë STOP LOSS</h5>
                                <p class="mb-1"><small>Maximum loss level</small></p>
                                <p class="mb-0"><span id="slLevel">0.85780</span></p>
                            </div>
                            <div class="col-4 text-end">
                                <div class="badge bg-danger fs-5" id="slPips">-20.0 pips</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Stats & Info -->
            <div class="col-lg-3">
                <!-- Multi-Timeframe Analysis -->
                <div class="glass-card p-4 mb-4">
                    <h4 class="mb-3">üìà Timeframe Analysis</h4>
                    <table class="table table-dark table-sm">
                        <tr>
                            <td>1 Hour</td>
                            <td class="text-end"><span id="tf1h" class="badge bg-success">BULLISH</span></td>
                        </tr>
                        <tr>
                            <td>15 Min</td>
                            <td class="text-end"><span id="tf15m" class="badge bg-warning">NEUTRAL</span></td>
                        </tr>
                        <tr>
                            <td>Daily</td>
                            <td class="text-end"><span id="tfDaily" class="badge bg-success">BULLISH</span></td>
                        </tr>
                        <tr>
                            <td>Weekly</td>
                            <td class="text-end"><span id="tfWeekly" class="badge bg-danger">BEARISH</span></td>
                        </tr>
                        <tr>
                            <td>Monthly</td>
                            <td class="text-end"><span id="tfMonthly" class="badge bg-info">NEUTRAL</span></td>
                        </tr>
                    </table>
                </div>

                <!-- Risk/Reward -->
                <div class="glass-card p-4 mb-4">
                    <h4 class="mb-3">‚öñÔ∏è Risk Management</h4>
                    <div class="text-center">
                        <div class="display-6 fw-bold text-warning" id="riskReward">1:1.6</div>
                        <p class="text-muted">Risk/Reward Ratio</p>
                        
                        <div class="row mt-3">
                            <div class="col-6">
                                <div class="glass-card p-2">
                                    <small>Potential Gain</small>
                                    <div class="fw-bold text-success" id="potentialGain">$320</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="glass-card p-2">
                                    <small>Potential Loss</small>
                                    <div class="fw-bold text-danger" id="potentialLoss">$200</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Controls -->
                <div class="glass-card p-4">
                    <h4 class="mb-3">‚öôÔ∏è Controls</h4>
                    <button onclick="refreshPrediction()" class="btn btn-primary w-100 mb-3">
                        üîÑ Update Now
                    </button>
                    <button onclick="autoRefreshToggle()" class="btn btn-outline-light w-100 mb-3">
                        ‚è∞ Auto-Refresh: <span id="autoRefreshStatus">ON</span>
                    </button>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="soundToggle" checked>
                        <label class="form-check-label" for="soundToggle">Alert Sounds</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Disclaimer -->
        <div class="glass-card p-3 mt-4 alert alert-warning">
            <h6><i class="fas fa-exclamation-triangle"></i> IMPORTANT DISCLAIMER</h6>
            <p class="mb-0 small">
                This is an educational tool for demonstration purposes. Forex trading involves substantial risk.
                Past performance does not guarantee future results. Never trade with money you cannot afford to lose.
            </p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let tradingChart;
        let autoRefreshInterval;
        let autoRefreshEnabled = true;
        
        // Initialize chart
        function initTradingChart() {
            const ctx = document.getElementById('tradingChart').getContext('2d');
            
            tradingChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 60}, (_, i) => `${i}min`),
                    datasets: [{
                        label: 'EUR/GBP Price',
                        data: Array.from({length: 60}, () => 0.86000 + Math.random() * 0.002 - 0.001),
                        borderColor: '#00b4db',
                        backgroundColor: 'rgba(0, 180, 219, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        annotation: {
                            annotations: {}
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#fff' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#fff' }
                        }
                    }
                }
            });
        }
        
        // Update chart with zones
        function updateChartWithZones(zones) {
            if (!tradingChart) return;
            
            // Update price data
            const newData = Array.from({length: 60}, (_, i) => {
                const base = zones.current_price;
                return base + (Math.sin(i / 10) * 0.001) + (Math.random() * 0.0005 - 0.00025);
            });
            
            tradingChart.data.datasets[0].data = newData;
            
            // Update annotation zones
            tradingChart.options.plugins.annotation.annotations = {
                entryZone: {
                    type: 'box',
                    xMin: 55,
                    xMax: 60,
                    yMin: zones.entry_zone.start,
                    yMax: zones.entry_zone.end,
                    backgroundColor: 'rgba(0, 180, 219, 0.3)',
                    borderColor: 'rgba(0, 180, 219, 0.8)',
                    borderWidth: 2,
                    label: {
                        display: true,
                        content: 'ENTRY ZONE',
                        position: 'top',
                        color: '#fff',
                        backgroundColor: 'rgba(0, 180, 219, 0.8)'
                    }
                },
                takeProfitLine: {
                    type: 'line',
                    yMin: zones.take_profit_line,
                    yMax: zones.take_profit_line,
                    borderColor: '#28a745',
                    borderWidth: 3,
                    borderDash: [5, 5],
                    label: {
                        display: true,
                        content: 'TAKE PROFIT',
                        position: 'end',
                        color: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.8)'
                    }
                },
                stopLossLine: {
                    type: 'line',
                    yMin: zones.stop_loss_line,
                    yMax: zones.stop_loss_line,
                    borderColor: '#dc3545',
                    borderWidth: 3,
                    borderDash: [5, 5],
                    label: {
                        display: true,
                        content: 'STOP LOSS',
                        position: 'end',
                        color: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.8)'
                    }
                }
            };
            
            tradingChart.update();
        }
        
        // Fetch prediction
        async function fetchPrediction() {
            try {
                const response = await fetch('/api/hourly-prediction');
                const data = await response.json();
                
                if (data.success) {
                    updateDisplay(data.prediction);
                }
            } catch (error) {
                console.log('Using fallback data');
                generateFallbackData();
            }
        }
        
        // Update display with prediction data
        function updateDisplay(prediction) {
            // Update basic info
            document.getElementById('currentPrice').textContent = prediction.current_price;
            document.getElementById('confidenceValue').textContent = prediction.confidence + '%';
            document.getElementById('confidenceFill').style.width = prediction.confidence + '%';
            
            // Update signal
            const signalElement = document.getElementById('predictionSignal');
            signalElement.textContent = prediction.signal;
            signalElement.className = 'signal-badge ';
            
            if (prediction.signal.includes('BUY')) {
                signalElement.classList.add('signal-buy');
                document.getElementById('entryAction').textContent = 'BUY';
                document.getElementById('entryAction').className = 'badge bg-success fs-5';
            } else if (prediction.signal.includes('SELL')) {
                signalElement.classList.add('signal-sell');
                document.getElementById('entryAction').textContent = 'SELL';
                document.getElementById('entryAction').className = 'badge bg-danger fs-5';
            } else {
                signalElement.classList.add('signal-neutral');
                document.getElementById('entryAction').textContent = 'WAIT';
                document.getElementById('entryAction').className = 'badge bg-secondary fs-5';
            }
            
            // Update trade levels
            document.getElementById('entryZoneRange').textContent = 
                `${(prediction.entry_price - 0.0002).toFixed(5)} - ${(prediction.entry_price + 0.0002).toFixed(5)}`;
            
            document.getElementById('tpLevel').textContent = prediction.take_profit;
            document.getElementById('slLevel').textContent = prediction.stop_loss;
            document.getElementById('tpPips').textContent = `+${prediction.pip_gain} pips`;
            document.getElementById('slPips').textContent = `-${prediction.pip_risk} pips`;
            
            // Update risk/reward
            document.getElementById('riskReward').textContent = `1:${prediction.risk_reward}`;
            
            // Update probabilities
            if (prediction.probabilities) {
                document.getElementById('successProb').textContent = prediction.probabilities.success_probability + '%';
                document.getElementById('riskLevel').textContent = prediction.probabilities.risk_probability + '%';
            }
            
            // Update hour end prediction
            if (prediction.hourly_prediction) {
                document.getElementById('hourEndPrice').textContent = prediction.hourly_prediction.predicted_price;
                document.getElementById('hourTrend').textContent = 
                    prediction.hourly_prediction.direction === 'UP' ? 'UP ‚ÜóÔ∏è' : 
                    prediction.hourly_prediction.direction === 'DOWN' ? 'DOWN ‚ÜòÔ∏è' : 'SIDEWAYS ‚ÜîÔ∏è';
            }
            
            // Update chart zones
            if (prediction.chart_zones) {
                updateChartWithZones(prediction.chart_zones);
            }
            
            // Update timestamp
            const now = new Date();
            const nextHour = new Date(now.getFullYear(), now.getMonth(), now.getDate(), now.getHours() + 1, 0, 0, 0);
            const timeDiff = nextHour - now;
            const minutes = Math.floor(timeDiff / 60000);
            const seconds = Math.floor((timeDiff % 60000) / 1000);
            
            document.getElementById('nextUpdate').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Update hour progress
            const progress = ((60 - minutes) / 60) * 100;
            document.getElementById('hourProgress').style.width = `${progress}%`;
            document.getElementById('timeRemaining').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Refresh prediction manually
        function refreshPrediction() {
            const btn = event?.target || document.querySelector('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Updating...';
            btn.disabled = true;
            
            fetchPrediction().finally(() => {
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 1000);
            });
        }
        
        // Toggle auto-refresh
        function autoRefreshToggle() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const statusElement = document.getElementById('autoRefreshStatus');
            
            if (autoRefreshEnabled) {
                statusElement.textContent = 'ON';
                statusElement.className = 'text-success';
                startAutoRefresh();
            } else {
                statusElement.textContent = 'OFF';
                statusElement.className = 'text-danger';
                clearInterval(autoRefreshInterval);
            }
        }
        
        // Start auto-refresh
        function startAutoRefresh() {
            if (autoRefreshInterval) clearInterval(autoRefreshInterval);
            
            autoRefreshInterval = setInterval(() => {
                // Check if it's a new hour
                const now = new Date();
                if (now.getMinutes() === 0 && now.getSeconds() <= 5) {
                    fetchPrediction();
                }
            }, 5000); // Check every 5 seconds
            
            // Also refresh every minute for data updates
            setInterval(fetchPrediction, 60000);
        }
        
        // Generate fallback data
        function generateFallbackData() {
            const current_price = 0.86000 + (Math.random() - 0.5) * 0.001;
            const signals = ['STRONG BUY', 'BUY', 'NEUTRAL', 'SELL', 'STRONG SELL'];
            const signal = signals[Math.floor(Math.random() * signals.length)];
            
            let entry, tp, sl;
            
            if (signal.includes('BUY')) {
                entry = current_price - 0.0002;
                tp = entry + 0.0020;
                sl = entry - 0.0012;
            } else if (signal.includes('SELL')) {
                entry = current_price + 0.0002;
                tp = entry - 0.0020;
                sl = entry + 0.0012;
            } else {
                entry = current_price;
                tp = current_price + 0.0010;
                sl = current_price - 0.0010;
            }
            
            const prediction = {
                current_price: current_price.toFixed(5),
                signal: signal,
                entry_price: entry.toFixed(5),
                take_profit: tp.toFixed(5),
                stop_loss: sl.toFixed(5),
                pip_gain: (Math.abs(tp - entry) / 0.0001).toFixed(1),
                pip_risk: (Math.abs(sl - entry) / 0.0001).toFixed(1),
                risk_reward: (Math.abs(tp - entry) / Math.abs(sl - entry)).toFixed(2),
                confidence: Math.floor(Math.random() * 20) + 75,
                probabilities: {
                    success_probability: Math.floor(Math.random() * 20) + 75,
                    risk_probability: Math.floor(Math.random() * 20) + 5
                },
                hourly_prediction: {
                    predicted_price: (current_price + (Math.random() - 0.5) * 0.002).toFixed(5),
                    direction: Math.random() > 0.5 ? 'UP' : 'DOWN'
                },
                chart_zones: {
                    entry_zone: {
                        start: (entry - 0.0002).toFixed(5),
                        end: (entry + 0.0002).toFixed(5),
                        center: entry.toFixed(5)
                    },
                    take_profit_line: tp.toFixed(5),
                    stop_loss_line: sl.toFixed(5),
                    current_price: current_price.toFixed(5)
                }
            };
            
            updateDisplay(prediction);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initTradingChart();
            fetchPrediction();
            startAutoRefresh();
            
            // Update time every second
            setInterval(() => {
                const now = new Date();
                const nextHour = new Date(now.getFullYear(), now.getMonth(), now.getDate(), now.getHours() + 1, 0, 0, 0);
                const timeDiff = nextHour - now;
                const minutes = Math.floor(timeDiff / 60000);
                const seconds = Math.floor((timeDiff % 60000) / 1000);
                
                document.getElementById('nextUpdate').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                document.getElementById('timeRemaining').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // Update progress bar
                const progress = ((60 - minutes) / 60) * 100;
                document.getElementById('hourProgress').style.width = `${progress}%`;
            }, 1000);
        });
    </script>
</body>
</html>